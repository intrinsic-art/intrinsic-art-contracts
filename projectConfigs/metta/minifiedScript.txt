console.log("Metta v5.2.0 \xa9 2023 Matto"),console.log(`TOKEN ID: ${artwork.tokenID}. TOKEN ENTROPY: ${artwork.seed}. TRAITS:`),console.log(artwork.traits);let tokenEntropy=artwork.seed,tokenEntropyPairs=createPairs(tokenEntropy),seed=getValue(0,255)*getValue(0,255)*getValue(0,255)*getValue(0,255),R=(e=1)=>Math.floor(mRando()*e);function mRando(e=1){return(seed=(1664525*seed+1013904223)%4294967296)/4294967296*e}let attributes=[],p=[],matte=16,hue,width,height,canvas,u,rando,nodes,mode,chaos,freeze,veiled,cellDynamic,connections,thickness,fade,cellDesign,colorMode,gradientShift,seekerNodeMod;const urlParams=new URLSearchParams(window.location.search),portrait=urlParams.get("portrait");let paused=!0,count=0,lastTime=0;function setup(){"true"==portrait?(width=.5625*(height=window.innerHeight))>window.innerWidth&&(height=(width=window.innerWidth)/.5625):(height=.5625*(width=window.innerWidth))>window.innerHeight&&(width=(height=window.innerHeight)/.5625),(canvas=document.createElement("canvas")).width=width,canvas.height=height,document.querySelector("body").appendChild(canvas),ctx=canvas.getContext("2d"),hue=20*getValue(1,18),rando=getValue(0,255)*getValue(0,255),nodes=parseInt(artwork.traits.nodes,10),(connections=parseInt(artwork.traits.connections,10))>nodes&&(connections=nodes-1),thickness=parseInt(artwork.traits.thickness,10),fade=(mode=parseInt(artwork.traits.mode,10))%3==0,chaos=mode>2,veiled=2==mode,cellDesign=parseInt(artwork.traits.cellDesign,10),colorMode=parseInt(artwork.traits.colorMode,10),cellDynamic=parseInt(artwork.traits.cellDynamic,10),readOutAttributes(),gradientShift=getValue(0,360),freeze=95,seekerNodeMod=!0==chaos?1:5==nodes?3:Math.floor(nodes/2),u=(thickness+1)*(window.innerHeight+window.innerWidth)/2e3,fade?(ctx.fillStyle="hsl(0, 0%, 10%)",ctx.fillRect(0,0,canvas.width,canvas.height)):(ctx.fillStyle="black",ctx.fillRect(0,0,canvas.width,canvas.height));for(let e=0;e<nodes;e++)p.push({x:R(1.5*width)-width/4,y:R(1.5*height)-height/4,r:0,c:[R(70)+20,R(90)+10]}),0==e&&(0==colorMode||3==colorMode||(console.log("(Primary Hue: "+hue+")"),2==colorMode&&console.log("(Secondary Hue: "+(hue+180)%360+")")))}function draw(e){if(e-lastTime>(count<freeze?1e3/(freeze-count+3):1e3/30)&&(lastTime=e,!paused||count<freeze)){count++,fade&&(ctx.fillStyle="hsla(0, 0%, 0%, 2%)",ctx.fillRect(0,0,canvas.width,canvas.height));for(let t=0;t<1e3;t++){let o=R(width),n=R(height),l=width*height,a,r;for(let s=0;s<p.length;s++)(r=Math.sqrt((o-p[s].x)**2+(n-p[s].y)**2))<l&&(l=r,a=s);ctx.lineWidth=.5*u;let c=hue,$=p[a].c[0];0==colorMode?$=0:2==colorMode?a%2==0&&(c=(hue+180)%360):3==colorMode&&(c=rando%2==0?p[a].x/width*360+gradientShift:p[a].y/height*360+gradientShift),ctx.strokeStyle=`hsl(${c}, ${$}%, ${p[a].c[1]}%)`,ctx.fillStyle=`hsl(${c}, ${$}%, ${p[a].c[1]}%)`;let d=p[a].x-o,h=p[a].y-n,g=20*Math.sqrt(d*d+h*h),y=p[a].x+.75*(o-p[a].x),_=p[a].y+.75*(n-p[a].y),f=p[a].x+1.1*(o-p[a].x),m=p[a].y+1.1*(n-p[a].y),k=1==cellDesign?g/20:0==cellDesign?g/30:g/40,D=o+-h/g*k,T=n+d/g*k,v=o+h/g*k,w=n+-d/g*k;if(0==cellDesign)ctx.beginPath(),ctx.moveTo(p[a].x,p[a].y),0==cellDynamic?ctx.lineTo(y,_):1==cellDynamic?ctx.lineTo(o,n):ctx.lineTo(f,m),ctx.stroke(),ctx.beginPath(),ctx.moveTo(D,T),ctx.lineTo(v,w),ctx.stroke();else if(1==cellDesign){let x;x=0==cellDynamic?.75*l:1==cellDynamic?l:1.25*l;let M=Math.atan2(T-p[a].y,D-p[a].x),b=Math.atan2(w-p[a].y,v-p[a].x);ctx.beginPath(),ctx.arc(p[a].x,p[a].y,x,M,b),ctx.stroke()}else if(2==cellDesign)ctx.fillStyle=`hsl(${c}, ${$}%, ${p[a].c[1]}%)`,0==cellDynamic?C(y,_,1.5*u):1==cellDynamic?C(o,n,1.5*u):C(f,m,1.5*u);else if(3==cellDesign){let P=0==cellDynamic?.7:.9;cellDynamic<2&&(D=p[a].x+P*(D-p[a].x),T=p[a].y+P*(T-p[a].y),v=p[a].x+P*(v-p[a].x),w=p[a].y+P*(w-p[a].y)),ctx.beginPath(),0==cellDynamic?(ctx.moveTo(p[a].x,p[a].y),ctx.lineTo(D,T),ctx.lineTo(y,_),ctx.lineTo(v,w)):1==cellDynamic?(ctx.moveTo(p[a].x,p[a].y),ctx.lineTo(D,T),ctx.lineTo(o,n),ctx.lineTo(v,w)):(ctx.moveTo(y,_),ctx.lineTo(D,T),ctx.lineTo(f,m),ctx.lineTo(v,w)),ctx.closePath(),ctx.stroke()}l>p[a].r&&(p[a].r=l,ctx.lineWidth=50/p[a].r*3*u,colorMode<2&&(0==colorMode?ctx.strokeStyle=`hsl(0, 0%, ${p[a].c[1]}%)`:(c=hue,ctx.strokeStyle=`hsl(${hue}, ${p[a].c[0]}%, ${p[a].c[1]}%)`),C(p[a].x,p[a].y,p[a].r,0)))}moveTowardNClosest(connections)}requestAnimationFrame(draw)}function moveTowardNClosest(e){for(let t=0;t<p.length;t++){let o=[];for(let n=0;n<p.length;n++)if(t!==n){let l=Math.sqrt((p[t].x-p[n].x)**2+(p[t].y-p[n].y)**2);o.push({dist:l,point:p[n]})}o.sort((e,t)=>e.dist-t.dist);let a=o[0].dist;veiled||(ctx.lineWidth=.5*u,C(p[t].x,p[t].y,2*u));for(let r=0;r<e&&r<o.length;r++){let s=u/(3*Math.pow(1.5,r));veiled||(ctx.beginPath(),ctx.moveTo(p[t].x,p[t].y),ctx.lineTo(o[r].point.x,o[r].point.y),ctx.stroke(),ctx.lineWidth=s*u);let c=1/(500*Math.pow(2,r));0!=t&&t%seekerNodeMod==0&&(c*=10),p[t].x+=(o[r].point.x-p[t].x)*c,p[t].y+=(o[r].point.y-p[t].y)*c}if(a<=5){if(p[t].x=R(1.5*width)-width/4,p[t].y=R(1.5*height)-height/4,p[t].r=0,0==t){let $=rando%2==0?hue-10:hue+10;$<0?$=360+$:$>360&&($-=360),hue=$,console.log("(New hue: "+hue+")")}p[t].c=[R(70)+20,R(90)+10]}}}function C(e,t,o,n){let l=0==n?100:60;ctx.beginPath();for(let a=0;a<l;a++){let r=e+o*Math.cos(2*Math.PI*a/l),s=t+o*Math.sin(2*Math.PI*a/l);0===a?ctx.moveTo(r,s):ctx.lineTo(r,s)}ctx.closePath(),0==n?ctx.stroke():ctx.fill()}function createPairs(e){let t=[];for(let o=0;o<(e.length-2)/2;o++)t.push(parseInt(e.slice(2+2*o,4+2*o),16));return t}function getValue(e,t){if(0===tokenEntropyPairs.length)throw Error("No entropy values left in tokenEntropyPairs.");let o=Math.floor(tokenEntropyPairs[0]*((t-e+1)/256)+e);return tokenEntropyPairs.shift(),o}function updateMatte(){document.body.style.backgroundColor=`rgb(${16*matte},${16*matte},${16*matte})`}function readOutAttributes(){for(e("Color Mode",0==colorMode?"Tri-X":1==colorMode?"Synchonized":2==colorMode?"Agree to Disaggree":"Gradient"),e("Cell Design",0==cellDesign?"Lines & walls":1==cellDesign?"Startrail":2==cellDesign?"Popcorn":3==cellDesign?"Shards":"Invisible"),e("Connections",2==connections?"Minimal":4==connections?"Intermediate":"Abundant"),e("Mode",0==mode?"Ephemeral":1==mode?"Enduring":2==mode?"Veiled":3==mode?"Ephemeral Frenzy":"Enduring Frenzy"),e("View",5==nodes?"Macro":20==nodes?"Medium":60==nodes?"Full":"Wide"),e("cellDynamic",0==cellDynamic?"Discreet":1==cellDynamic?"Adjacent":"Interwoven"),e("Stroke",0==thickness?"Light":1==thickness?"Regular":"Bold"),console.log(""),console.log("#######################"),console.log("ATTRIBUTES:"),i=0;i<attributes.length;i++)console.log(attributes[i].trait_type+": "+attributes[i].value);function e(e,t){"boolean"==typeof t&&(t=t.toString()),attributes.push({trait_type:e,value:t})}console.log("#######################"),console.log(""),sessionStorage.setItem("attributes",JSON.stringify(attributes))}setup(),requestAnimationFrame(draw),canvas.addEventListener("dblclick",function(e){console.log("Canvas double-clicked:",e),paused=!paused}),document.addEventListener("keydown",function(e){if(" "===e.key)paused=!paused;else if("s"===e.key||"S"===e.key){let t=document.createElement("a");t.download=`Metta-${artwork.tokenID}.png`,t.href=canvas.toDataURL(),t.click()}else"<"===e.key?(0!=matte?matte--:matte=16,updateMatte()):">"===e.key&&(16!=matte?matte++:matte=0,updateMatte())});